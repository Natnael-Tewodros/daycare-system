generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String     @id
  name         String
  email        String     @unique
  password     String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @default(now()) @updatedAt
  username     String?    @unique
  profileImage String?
  role         UserRole   @default(ADMIN)
  children     Child[]    @relation("ParentChildren")
  activities   Activity[] @relation("ParentActivities")
}

model Child {
  id                  Int                  @id @default(autoincrement())
  fullName            String
  parentName          String
  option              String
  dateOfBirth         DateTime
  roomId              Int?
  caregiverId         Int?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  childInfoFile       String?
  organizationId      Int
  profilePic          String?
  relationship        Relationship
  gender              Gender
  approvalStatus      String               @default("pending")
  enrollmentRequestId Int?
  parentEmail         String?
  parentId            String?
  parentPassword      String?
  siteId              Int?
  attendances         Attendance[]
  enrollmentRequest   EnrollmentRequest?   @relation(fields: [enrollmentRequestId], references: [id])
  organization        Organization         @relation(fields: [organizationId], references: [id])
  parent              User?                @relation("ParentChildren", fields: [parentId], references: [id])
  room                Room?                @relation(fields: [roomId], references: [id])
  caregiver           Caregiver?           @relation(fields: [caregiverId], references: [id])
  site                Site?                @relation("SiteChildren", fields: [siteId], references: [id])
  eventParticipations EventParticipation[]
  reports             Report[]
  dailyObservations   DailyObservation[]
}

model Caregiver {
  id               Int              @id @default(autoincrement())
  fullName         String
  email            String?
  phone            String
  medicalReport    String?
  assignedRoomId   Int?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  canTransferRooms Boolean          @default(false)
  organizationType OrganizationType
  siteId           Int?
  children         Child[]
  assignedRoom     Room?            @relation(fields: [assignedRoomId], references: [id])
  site             Site?            @relation("SiteCaregivers", fields: [siteId], references: [id])
  organization     Organization?    @relation(fields: [organizationId], references: [id])
  organizationId   Int?
  announcements    Announcement[]
}

model Site {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  logo        String?
  address     String?
  phone       String?
  email       String?
  website     String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  children    Child[]     @relation("SiteChildren")
  caregivers  Caregiver[] @relation("SiteCaregivers")
}

model Organization {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  address   String?
  email     String?
  logo      String?
  phone     String?
  website   String?
  children  Child[]
  rooms       Room[]
  caregivers  Caregiver[]
}

model Room {
  id             Int           @id @default(autoincrement())
  name           String
  ageRange       String
  organizationId Int?
  children       Child[]
  organization   Organization? @relation(fields: [organizationId], references: [id])
  caregivers     Caregiver[]
  announcements  Announcement[]
}

model Attendance {
  id           Int       @id @default(autoincrement())
  childId      Int
  status       String
  checkInTime  DateTime?
  checkOutTime DateTime?
  broughtBy    String?
  takenBy      String?
  createdAt    DateTime  @default(now())
  child        Child     @relation(fields: [childId], references: [id])
}

model Report {
  id           Int       @id @default(autoincrement())
  childId      Int
  title        String
  content      String
  reportType   String    @default("weekly") // "weekly", "monthly", "custom"
  weekStart    DateTime? // Start of the reporting period
  weekEnd      DateTime? // End of the reporting period
  createdAt    DateTime  @default(now())
  child        Child     @relation(fields: [childId], references: [id])
}

model DailyObservation {
  id              Int       @id @default(autoincrement())
  childId         Int
  observationDate DateTime  @default(now())
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Activities & Learning
  activities      String[]  // List of activities participated in
  engagementLevel String?   // "low", "medium", "high"
  skillNotes      String?   // Notes about skill development
  
  // Behavior & Emotional
  mood            String?   // "happy", "calm", "energetic", "tired", etc.
  cooperation     String?   // "excellent", "good", "needs_reminders"
  socialNotes     String?   // Notes about social interactions
  
  // Health & Hygiene
  healthStatus    String?   // "healthy", "mild_symptoms", etc.
  hygieneNotes    String?   // Notes about hygiene
  energyLevel     String?   // "high", "normal", "low"
  eatingHabits    String?   // "good", "fair", "poor"
  
  // Meals
  breakfastStatus String?   // "eaten", "partial", "skipped"
  lunchStatus     String?   // "eaten", "partial", "skipped"
  snackStatus     String?   // "eaten", "partial", "skipped"
  
  // Sleep
  napStartTime    DateTime?
  napDuration     Int?      // Duration in minutes
  sleepQuality    String?   // "restful", "light", "troubled"
  
  // Teacher Notes
  teacherNotes    String?
  
  child           Child     @relation(fields: [childId], references: [id], onDelete: Cascade)
  
  @@index([childId, observationDate])
}

model EnrollmentRequest {
  id                 Int       @id @default(autoincrement())
  parentName         String
  childName          String
  childAge           Int
  email              String
  phone              String?
  preferredStartDate DateTime?
  status             String    @default("pending")
  notes              String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  children           Child[]
}

model Announcement {
  id             Int                @id @default(autoincrement())
  title          String
  content        String
  type           AnnouncementType   @default(GENERAL)
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  visibilityDays Int?
  attachments    String[]           @default([])
  caregivers     Caregiver[]
  rooms          Room[]
  views          AnnouncementView[]
}

model AnnouncementView {
  id             Int          @id @default(autoincrement())
  announcementId Int
  userId         String?
  userEmail      String?
  viewedAt       DateTime     @default(now())
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)

  @@unique([announcementId, userId])
  @@unique([announcementId, userEmail])
}

model Event {
  id             Int                  @id @default(autoincrement())
  title          String
  description    String?
  eventDate      DateTime
  eventType      EventType
  location       String?
  isActive       Boolean              @default(true)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  participations EventParticipation[]
}

model EventParticipation {
  id        Int                 @id @default(autoincrement())
  childId   Int
  eventId   Int
  status    ParticipationStatus @default(REGISTERED)
  notes     String?
  createdAt DateTime            @default(now())
  child     Child               @relation(fields: [childId], references: [id])
  event     Event               @relation(fields: [eventId], references: [id])

  @@unique([childId, eventId])
}

model Notification {
  id          Int       @id @default(autoincrement())
  parentEmail String
  title       String
  message     String
  type        String    @default("info")
  isRead      Boolean   @default(false)
  activityId  Int?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  activity    Activity? @relation(fields: [activityId], references: [id], onDelete: Cascade)
}


model Activity {
  id          Int       @id @default(autoincrement())
  subject     String
  description String?
  recipients  String[]
  attachments String[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  senderType  String    @default("admin") // "admin" or "parent"
  parentEmail String?   // only for parent messages
  parentId    String?   // reference to the parent user
  parent      User?     @relation("ParentActivities", fields: [parentId], references: [id])
  notifications Notification[]
}
enum UserRole {
  ADMIN
  PARENT
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Relationship {
  FATHER
  MOTHER
  OTHER
}

enum OrganizationType {
  INSA
  AI
  MINISTRY_OF_PEACE
  FINANCE_SECURITY
}

enum AnnouncementType {
  GENERAL
  IMPORTANT
  EVENT
}

enum EventType {
  BIRTHDAY
  HOLIDAY
  EDUCATIONAL
  SPORTS
  CULTURAL
  OTHER
}

enum ParticipationStatus {
  REGISTERED
  ATTENDED
  ABSENT
  CANCELLED
}



